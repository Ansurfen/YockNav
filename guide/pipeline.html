<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Use yock to build pipelines | Yock</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/YockNav/favicon.ico">
    <meta name="description" content="Yock is a solution of cross platform to compose distributed build stream.">
    
    <link rel="preload" href="/YockNav/assets/css/0.styles.f04dfcdd.css" as="style"><link rel="preload" href="/YockNav/assets/js/app.017c9b8b.js" as="script"><link rel="preload" href="/YockNav/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/YockNav/assets/js/13.d46a66f2.js" as="script"><link rel="prefetch" href="/YockNav/assets/js/10.79e825b6.js"><link rel="prefetch" href="/YockNav/assets/js/11.0ad21971.js"><link rel="prefetch" href="/YockNav/assets/js/12.842c3faa.js"><link rel="prefetch" href="/YockNav/assets/js/14.9d98051a.js"><link rel="prefetch" href="/YockNav/assets/js/15.2512b8b0.js"><link rel="prefetch" href="/YockNav/assets/js/16.5d446a35.js"><link rel="prefetch" href="/YockNav/assets/js/17.9b5a86c2.js"><link rel="prefetch" href="/YockNav/assets/js/18.a9c618f3.js"><link rel="prefetch" href="/YockNav/assets/js/19.28052ebe.js"><link rel="prefetch" href="/YockNav/assets/js/20.dfe4459d.js"><link rel="prefetch" href="/YockNav/assets/js/21.3266340c.js"><link rel="prefetch" href="/YockNav/assets/js/22.adc37eab.js"><link rel="prefetch" href="/YockNav/assets/js/23.88fd9476.js"><link rel="prefetch" href="/YockNav/assets/js/24.8190498c.js"><link rel="prefetch" href="/YockNav/assets/js/3.e9d031a5.js"><link rel="prefetch" href="/YockNav/assets/js/4.d12742be.js"><link rel="prefetch" href="/YockNav/assets/js/5.216cae74.js"><link rel="prefetch" href="/YockNav/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/YockNav/assets/js/7.9c9172a7.js"><link rel="prefetch" href="/YockNav/assets/js/8.df31b9d1.js"><link rel="prefetch" href="/YockNav/assets/js/9.295cb0ae.js">
    <link rel="stylesheet" href="/YockNav/assets/css/0.styles.f04dfcdd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/YockNav/" class="home-link router-link-active"><img src="/YockNav/favicon.ico" alt="Yock" class="logo"> <span class="site-name can-hide">Yock</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/YockNav/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/YockNav/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/YockNav/zh/module.html" class="nav-link">
  Module
</a></div><div class="nav-item"><a href="/YockNav/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="https://github.com/Ansurfen/yock" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/YockNav/guide/pipeline.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/YockNav/zh/guide/pipeline.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/YockNav/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/YockNav/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/YockNav/zh/module.html" class="nav-link">
  Module
</a></div><div class="nav-item"><a href="/YockNav/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="https://github.com/Ansurfen/yock" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/YockNav/guide/pipeline.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/YockNav/zh/guide/pipeline.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/YockNav/guide/introduce.html" class="sidebar-link">Your next build-tool is not build-tool.</a></li><li><a href="/YockNav/guide/gnu.html" class="sidebar-link">Use yock instead of batch and shell scripts</a></li><li><a href="/YockNav/guide/pipeline.html" aria-current="page" class="active sidebar-link">Use yock to build pipelines</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/YockNav/guide/pipeline.html#job-task" class="sidebar-link">Job &amp; Task</a></li><li class="sidebar-sub-header"><a href="/YockNav/guide/pipeline.html#context" class="sidebar-link">Context</a></li></ul></li><li><a href="/YockNav/guide/concurrency.html" class="sidebar-link">yock concurrent programming</a></li><li><a href="/YockNav/guide/ypm.html" class="sidebar-link">yock package-manager tool</a></li><li><a href="/YockNav/guide/module.html" class="sidebar-link">yock module development</a></li><li><a href="/YockNav/guide/sdk.html" class="sidebar-link">yock service develop</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Yock does not directly provide pipeline-related specifications, but does provide related functions that can build pipelines, which also makes yock more flexible in scheduling.</p> <h2 id="job-task"><a href="#job-task" class="header-anchor">#</a> Job &amp; Task</h2> <div class="language-lua extra-class"><pre class="language-lua"><code><span class="token comment">---@param name string</span>
<span class="token comment">---@param callback fun(ctx: context)</span>
<span class="token keyword">function</span> <span class="token function">job</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token keyword">end</span>

<span class="token comment">---@param name string</span>
<span class="token comment">---@vararg string</span>
<span class="token keyword">function</span> <span class="token function">jobs</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span> <span class="token keyword">end</span>
</code></pre></div><p>Job: The smallest component of a task, a task can consist of one or more jobs. It is not difficult to see from the function signature that each job is a unit whose name is bound to the callback function. If a user defines a job with the same name in the same file, Yock will throw an error, so each job name must be unique.
Jobs: Compose multiple jobs to form a Task and share the namespace with the job. This means that if jobs and job have the same name, yock will also throw an error directly.</p> <div class="language-lua extra-class"><pre class="language-lua"><code><span class="token comment">--- main.lua</span>
<span class="token function">job</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;start test...&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token function">job</span><span class="token punctuation">(</span><span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;start build...&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token function">job</span><span class="token punctuation">(</span><span class="token string">&quot;deploy&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;start deploy...&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token function">jobs</span><span class="token punctuation">(</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;deploy&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>In view of the above introduction, it is not difficult to see the task (Task consists of one or more jobs) in this code:</p> <table><thead><tr><th>Task</th> <th style="text-align:center;">Jobs</th></tr></thead> <tbody><tr><td>test</td> <td style="text-align:center;">test</td></tr> <tr><td>build</td> <td style="text-align:center;">build</td></tr> <tr><td>depoly</td> <td style="text-align:center;">depoly</td></tr> <tr><td>all</td> <td style="text-align:center;">test, build, depoly</td></tr></tbody></table> <p>It is fairly easy to schedule them by task, just add the specified task name to the running file. For example, run the ALL task, <code>yock run main.lua all</code>. Running multiple tasks at the same time is also supported, <code>yock run main.lua all depoly</code>. Each task is executed asynchronously by coroutines, while the jobs within a task are executed sequentially.</p> <h2 id="context"><a href="#context" class="header-anchor">#</a> Context</h2> <p>According to the above introduction, in addition to having a certain understanding of Job, I believe you must be curious about what the parameter of the context type passed in the job callback function does. As the name suggests, it's a context type that operates the lifecycle of the Task process.</p> <p>Imagine a scenario where if the <code>test</code> plan fails during the scheduling of an <code>all</code> task, do you want to continue <code>build</code>? This creates a branch, and there is no way to control this at the user level other than to introduce global variables. Because yock only provides a callback function, it does not provide the ability to compose callback functions. Hence the ctx variable is designed. If you want to terminate the entire task, just add <code>ctx.exit(0)</code> to the end of the callback function, and it will terminate the execution of the task. Note that tasks are dispatched asynchronously, so it will not affect the normal scheduling of the entire program, if you want to end the whole program just <code>os.exit()</code>. To get back to home, if you don't want to end the scheduling, you can pass 1 to exit, and he will continue to execute the next job of this task.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/YockNav/guide/gnu.html" class="prev">
        Use yock instead of batch and shell scripts
      </a></span> <span class="next"><a href="/YockNav/guide/concurrency.html">
        yock concurrent programming
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/YockNav/assets/js/app.017c9b8b.js" defer></script><script src="/YockNav/assets/js/2.733019b2.js" defer></script><script src="/YockNav/assets/js/13.d46a66f2.js" defer></script>
  </body>
</html>
