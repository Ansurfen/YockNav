import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as t,c as s,d as a}from"./app-62237bf4.js";const e={},o=a(`<p>Yock does not directly provide pipeline-related specifications, but does provide related functions that can build pipelines, which also makes yock more flexible in scheduling.</p><h2 id="job-task" tabindex="-1"><a class="header-anchor" href="#job-task" aria-hidden="true">#</a> Job &amp; Task</h2><div class="language-lua line-numbers-mode" data-ext="lua"><pre class="language-lua"><code><span class="token comment">---@param name string</span>
<span class="token comment">---@param callback fun(ctx: context)</span>
<span class="token keyword">function</span> <span class="token function">job</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token keyword">end</span>

<span class="token comment">---@param name string</span>
<span class="token comment">---@vararg string</span>
<span class="token keyword">function</span> <span class="token function">jobs</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span> <span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Job: The smallest component of a task, a task can consist of one or more jobs. It is not difficult to see from the function signature that each job is a unit whose name is bound to the callback function. If a user defines a job with the same name in the same file, Yock will throw an error, so each job name must be unique.</p><p>Jobs: Compose multiple jobs to form a Task and share the namespace with the job. This means that if jobs and job have the same name, yock will also throw an error directly.</p><div class="language-lua line-numbers-mode" data-ext="lua"><pre class="language-lua"><code><span class="token comment">--- main.lua</span>
<span class="token function">job</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;start test...&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token function">job</span><span class="token punctuation">(</span><span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;start build...&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token function">job</span><span class="token punctuation">(</span><span class="token string">&quot;deploy&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;start deploy...&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token function">jobs</span><span class="token punctuation">(</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;deploy&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In view of the above introduction, it is not difficult to see the task (Task consists of one or more jobs) in this code:</p><table><thead><tr><th style="text-align:center;">Tasks</th><th style="text-align:center;">Jobs</th></tr></thead><tbody><tr><td style="text-align:center;">test</td><td style="text-align:center;">test</td></tr><tr><td style="text-align:center;">build</td><td style="text-align:center;">build</td></tr><tr><td style="text-align:center;">depoly</td><td style="text-align:center;">depoly</td></tr><tr><td style="text-align:center;">all</td><td style="text-align:center;">test, build, depoly</td></tr></tbody></table><p>It is fairly easy to schedule them by task, just add the specified task name to the running file. For example, run the ALL task, <code>yock run main.lua all</code>. Running multiple tasks at the same time is also supported, <code>yock run main.lua all depoly</code>. Each task is executed asynchronously by coroutines, while the jobs within a task are executed sequentially.</p><h2 id="context" tabindex="-1"><a class="header-anchor" href="#context" aria-hidden="true">#</a> Context</h2><p>According to the above introduction, in addition to having a certain understanding of Job, I believe you must be curious about what the parameter of the context type passed in the job callback function does. As the name suggests, it&#39;s a context type that operates the lifecycle of the Task process.</p><p>Imagine a scenario where if the <code>test</code> plan fails during the scheduling of an <code>all</code> task, do you want to continue <code>build</code>? This creates a branch, and there is no way to control this at the user level other than to introduce global variables. Because yock only provides a callback function, it does not provide the ability to compose callback functions. Hence the ctx variable is designed. If you want to terminate the entire task, just add <code>ctx.exit(0)</code> to the end of the callback function, and it will terminate the execution of the task. Note that tasks are dispatched asynchronously, so it will not affect the normal scheduling of the entire program, if you want to end the whole program just <code>os.exit()</code>. To get back to home, if you don&#39;t want to end the scheduling, you can pass 1 to exit, and he will continue to execute the next job of this task.</p>`,12),i=[o];function c(l,p){return t(),s("div",null,i)}const r=n(e,[["render",c],["__file","pipeline.html.vue"]]);export{r as default};
